<div class="activities-container">
    <!-- Header Section with Search and Filter -->
    <div class="header-section">
        <div class="search-filter-row">
            <mat-form-field appearance="outline" class="search-field">
                <mat-label>Search activities</mat-label>
                <input matInput [formControl]="searchControl" placeholder="Search by name or description">
                <mat-icon matSuffix>search</mat-icon>
            </mat-form-field>
            
            <button mat-fab color="primary" aria-label="Open filters" (click)="openFilterBottomSheet()" class="filter-button">
                <mat-icon>tune</mat-icon>
            </button>
        </div>
        
        <!-- Active Filters Display -->
        @if (hasActiveFilters()) {
        <div class="active-filters">
            <span class="filter-label">Active filters:</span>
            <div class="filter-chips">
                @if (filterForm.get('name')?.value) {
                <mat-chip-option (removed)="removeFilter('name')">
                    <mat-icon>text_fields</mat-icon>
                    {{ filterForm.get('name')?.value }}
                    <mat-icon matChipRemove>cancel</mat-icon>
                </mat-chip-option>
                }
                @if (filterForm.get('location')?.value) {
                <mat-chip-option (removed)="removeFilter('location')">
                    <mat-icon>location_on</mat-icon>
                    {{ filterForm.get('location')?.value }}
                    <mat-icon matChipRemove>cancel</mat-icon>
                </mat-chip-option>
                }
                @if (filterForm.get('season')?.value) {
                <mat-chip-option (removed)="removeFilter('season')">
                    <mat-icon>calendar_today</mat-icon>
                    {{ getSeasonDisplayName(filterForm.get('season')?.value) }}
                    <mat-icon matChipRemove>cancel</mat-icon>
                </mat-chip-option>
                }
                @if (filterForm.get('weather')?.value) {
                <mat-chip-option (removed)="removeFilter('weather')">
                    <mat-icon>wb_sunny</mat-icon>
                    {{ getWeatherDisplayName(filterForm.get('weather')?.value) }}
                    <mat-icon matChipRemove>cancel</mat-icon>
                </mat-chip-option>
                }
                @if (filterForm.get('groupSize')?.value > 1) {
                <mat-chip-option (removed)="removeFilter('groupSize')">
                    <mat-icon>group</mat-icon>
                    {{ filterForm.get('groupSize')?.value }} people
                    <mat-icon matChipRemove>cancel</mat-icon>
                </mat-chip-option>
                }
                @if (filterForm.get('price')?.value > -1) {
                <mat-chip-option (removed)="removeFilter('price')">
                    <mat-icon>euro</mat-icon>
                    Under ${{ filterForm.get('price')?.value }}
                    <mat-icon matChipRemove>cancel</mat-icon>
                </mat-chip-option>
                }
                <button mat-stroked-button size="small" (click)="resetFilters()">Clear all</button>
            </div>
        </div>
        }
    </div>

    <!-- View Toggle -->
    <div class="view-toggle">
        <mat-button-toggle-group [(value)]="viewMode" (change)="checkForBookmarking($event.value)">
            <mat-button-toggle value="grid">
                <mat-icon>grid_view</mat-icon> Grid
            </mat-button-toggle>
            <mat-button-toggle value="list">
                <mat-icon>view_list</mat-icon> List
            </mat-button-toggle>
            @if (isSmallScreen) {
            <mat-button-toggle value="bookmark">
                <mat-icon>bookmark</mat-icon> Bookmarked
            </mat-button-toggle>
            }
        </mat-button-toggle-group>
        
        <div class="results-count">
            {{ getResultsCountText() }}
        </div>
    </div>

    <!-- Loading State -->
    @if (isLoading) {
    <div class="loading-container">
        <mat-spinner></mat-spinner>
        <p>Loading activities...</p>
    </div>
    }

    <!-- No Results Message -->
    @if (filteredActivities().length === 0 && !isLoading) {
    <div class="no-results">
        <app-not-found [imageUrl]="'/assets/img/no_activities.png'"
            text="We couldn't find any results for that search. It's okay! A slightly different query might do the trick. Keep experimenting - your ideal results are waiting!"></app-not-found>
    </div>
    }

    <!-- Grid View -->
    @if (viewMode === 'grid' && filteredActivities().length > 0 && !isLoading) {
    <div class="grid-view">
        @for (activity of paginatedActivities; track activity.activityId) {
        <div class="grid-item">
            <app-activity-card [activity]="activity" [myActivity]="false"></app-activity-card>
        </div>
        }
    </div>
    }

    <!-- List View -->
    @if (viewMode === 'list' && filteredActivities().length > 0 && !isLoading) {
    <div class="list-view">
        @for (activity of paginatedActivities; track activity.activityId) {
        <mat-card class="list-item">
            <div class="list-item-content">
                <div class="list-item-image" [style.background-image]="'url(' + activity.firebaseUrl + ')'">
                </div>
                <div class="list-item-details">
                    <mat-card-title>{{ activity.title }}</mat-card-title>
                    <div class="activity-info">
                        <div>
                            <mat-icon>group</mat-icon> {{ activity.groupSizeMin }}-{{ activity.groupSizeMax }} people
                        </div>
                        <div>
                            <mat-icon>euro</mat-icon> {{ activity.costs }}
                        </div>
                        <div>
                            <mat-icon>{{ activity.indoor ? 'home' : 'landscape' }}</mat-icon> {{ activity.indoor ?
                            'Indoor' : 'Outdoor' }}
                        </div>
                    </div>
                    <p class="description-truncate">{{ activity.description }}</p>
                </div>
                <div class="list-item-button">
                    <button mat-icon-button (click)="navigateToDetails(activity.activityId)">
                        <mat-icon class="add-icon">arrow_forward_ios</mat-icon>
                    </button>
                </div>
            </div>
        </mat-card>
        }
    </div>
    }

    <!-- Bookmarked View -->
    @if (viewMode === 'bookmark' && filteredActivities().length > 0 && !isLoading) {
    <div class="grid-view">
        @for (activity of bookmarkedActivities(); track activity.activityId) {
        <div class="grid-item">
            <app-activity-card [activity]="activity" [myActivity]="true"></app-activity-card>
        </div>
        }
    </div>
    }

    <!-- Pagination -->
    @if (filteredActivities().length > 0 && !isLoading) {
    <mat-paginator [length]="paginatorLength" [pageSize]="pageSize" [pageSizeOptions]="[6, 12, 24, 48]"
        (page)="onPageChange($event)" showFirstLastButtons>
    </mat-paginator>
    }
</div>